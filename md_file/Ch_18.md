# Paging

## Concept of Paging

Paging splits address space into fixed-sized units called **pages**.  
Physical memory uses **physical frame numbers (PFN)**, and virtual memory uses **virtual page numbers (VPN)**.  
VPN → PFN 변환은 **Page Table**을 이용한다.

Fixed-size unit을 사용하므로 다음 장점을 가진다:

- **Flexibility**: 매핑만 조정하면 됨  
- **Simplicity**: 동일한 크기 → allocation/free가 단순

Page Table은 공간 요구량이 매우 크므로 **physical memory에 저장**된다.

---

## Address Space Example

| addr(range) | page   |
|-------------|--------|
| 0 ~ 15      | page 0 |
| 16 ~ 31     | page 1 |
| 32 ~ 47     | page 2 |
| 48 ~ 63     | page 3 |

---

## Page Table Example

| VPN (index) | PFN |
|-------------|-----|
| 0           | 3   |
| 1           | 7   |
| 2           | 5   |
| 3           | 2   |

---

## Physical Memory Example

| addr(range) | data            | page frame |
|-------------|-----------------|------------|
| 0 ~ 15      | reserved of OS  | PFN 0      |
| 16 ~ 31     | unused          | PFN 1      |
| 32 ~ 47     | page 3 of AS    | PFN 2      |
| 48 ~ 63     | page 0 of AS    | PFN 3      |
| 64 ~ 79     | unused          | PFN 4      |
| 80 ~ 95     | page 2 of AS    | PFN 5      |
| 96 ~ 111    | unused          | PFN 6      |
| 112 ~ 127   | page 1 of AS    | PFN 7      |

---

## Address Translation

Virtual Address = **VPN + Offset**

예:

- Page size = 16B → offset = 4 bits  
- Address space = 64B → total 6 bits  
- VPN = 2 bits

Virtual address `21 = 010101₂`:

- 01 | 0101 → VPN = 1, offset = 5

Page Table에서 VPN 1 → PFN 7

Physical address:

- PFN | offset = 111 | 0101 = 0b1110101

---

## Common Page Table Entry (PTE) Flags

- **valid bit**
- **protection bit**
- **present bit**
- **dirty bit**
- **reference bit**

---

## Why Paging is Slow?

Paging은 memory access가 추가로 필요함:

1. Page table base 위치(PTBR) 확인  
2. VPN으로 PTE 위치 계산  
3. Memory에서 PTE 읽기  
4. PFN으로 실제 메모리 접근  

즉, **추가 memory access 때문에 느림**.

---

## Pseudo Code (Address Translation)

```c
VPN = (virtualaddress & vpn_mask) >> SHIFT;

PTEaddr = PTBR + (VPN * sizeof(PTE));
// PTBR + VPN 인덱스 * 엔트리 크기
