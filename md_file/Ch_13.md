# Memory Virtualization

## 1. 개념 정리

- OS virtualizes its physical memory  
  → 운영체제는 **물리 메모리(physical memory)를 가상화**한다.

- OS provides an illusion memory space per each process  
  → 운영체제는 **각 프로세스마다 독립적인 메모리 공간이 있는 것처럼 보이게 하는 환상**을 제공한다.

- It seems to be seen like process uses the whole memory  
  → 겉보기에는 **각 프로세스가 시스템의 전체 메모리를 혼자 사용하는 것처럼 보인다.**

⇒ 즉, **여러 프로세스가 하나의 physical memory를 가상화(virtualization)를 통해 공유**하며,  
이는 CPU를 가상화하여 각 프로세스가 CPU를 독점하는 것처럼 보이게 하는 **CPU Virtualization과 유사한 개념**이다.

---

## 2. 단일 프로세스 적재 방식의 한계

- Load only one process in memory → **Poor utilization and efficiency**
  - 초기 OS는 한 번에 **하나의 프로세스만 메모리에 적재**했다.
  - 이 경우 CPU와 메모리 활용도가 낮아져 **효율성과 성능이 떨어지는 문제**가 있었다.

---

## 3. Multiprogramming & Time Sharing

- **Multiprogramming / Time Sharing**
  - 메모리에 **여러 프로세스**를 동시에 적재한다.
  - CPU는 **time sharing 기반**으로 여러 프로세스를 번갈아가며 실행한다.
  - 이를 통해 **자원 활용도와 시스템 전체 성능을 향상**시킨다.

---

## 4. Protection Issue & Errant Memory

여러 프로세스를 동시에 메모리에 올리면 **보호(protection) 문제**가 발생한다.

- 예시:  
  - Process C가 잘못된 포인터(pointer)를 사용해  
    원래 **Process A가 사용하던 메모리 영역에 접근**하는 경우
  - 이런 잘못된 메모리 접근을 **Errant Memory**라고 볼 수 있다.

⇒ 이를 막기 위해 **OS가 물리 메모리를 추상화(abstraction of physical memory)** 한다.

- 각 프로세스는 **자신만의 고립된(isolated) 메모리 공간**을 가진 것처럼 보인다.
- OS는 **physical memory ↔ address space**를 매핑(mapping)하여 이를 구현한다.

---

## 5. Address Space

### 5.1 Address Space의 구성

하나의 프로세스가 보는 **address space**는 보통 다음과 같이 구성된다.

- **Code (Text)** : 실행할 기계어 코드
- **Data** : 전역 변수, 정적 변수
- **Heap** : 동적 메모리 영역 (`malloc`, `new` 등)
- **Stack** : 함수 호출, 지역 변수, 리턴 주소 등

이 중에서,

- **Heap과 Stack은 크기가 변할 수 있는 영역**이다.  
  (프로그램 실행 중 동적으로 커지거나 줄어든다.)

### 5.2 Virtual Address

- 실행 중인 프로그램이 사용하는 **모든 주소는 Virtual Address**이다.
- 프로그램은 **자신의 address space만 본다.**
- OS와 하드웨어가 협력하여 **Virtual Address를 Physical Address로 변환(translate)** 한다.

---

## 6. Address의 범위와 실제 배치

- 프로그램이 보는 주소 값들은 **자신의 address space 범위 내에서만 유효**하다.
- 실제 물리 메모리 상에서는
  - 주소들이 **위에서부터(0번지부터) 연속적으로 깔끔하게 배치되는 것이 아니라**,  
  - OS의 메모리 관리 정책에 따라 **여러 곳에 흩어져서 할당**될 수 있다.
- 하지만 프로세스 입장에서는 “연속적인 하나의 논리적 메모리 공간”처럼 보이도록 **OS가 가상 메모리를 제공**한다.
